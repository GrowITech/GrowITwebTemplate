<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
    <title>Datepicker &amp; Difference</title>
    <link
      rel="stylesheet"
      href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7/themes/redmond/jquery-ui.css"
      media="screen"
    />
    <script
      type="text/javascript"
      src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7/jquery-ui.min.js"
    ></script>
    <script type="text/javascript">
      var DatePicked = function () {
        var departure = $("#departure");
        var arrival = $("#arrival");
        var nights = $("#nights");

        var triggeringElement = $(this);

        var departureDate = departure.datepicker("getDate");

        var minArrivalDate = new Date();
        if (departureDate != null) {
          minArrivalDate.setDate(departureDate.getDate() + 2);
        } else {
          minArrivalDate.setDate(minArrivalDate.getDate() + 1);
        }
        arrival.datepicker("option", "minDate", minArrivalDate);

        var arrivalDate = arrival.datepicker("getDate");

        if (
          departureDate != null &&
          arrivalDate != null &&
          triggeringElement.attr("id") != "nights"
        ) {
          var oneDay = 1000 * 60 * 60 * 24;
          var difference = Math.ceil(
            (arrivalDate.getTime() - departureDate.getTime()) / oneDay
          );
          nights.val(difference);
        } else if (
          departureDate != null &&
          triggeringElement.attr("id") == "nights"
        ) {
          var nightsEntered = parseInt(nights.val());
          if (nightsEntered >= 2) {
            var newArrivalDate = new Date();
            newArrivalDate.setDate(departureDate.getDate() + nightsEntered);
            arrival.datepicker("setDate", newArrivalDate);
          } else {
            alert("Nights must be greater than 2.");
          }
        }
      };
      $(function () {
        $("#departure, #arrival").datepicker({
          onSelect: DatePicked,
        });
        $("#nights").change(DatePicked);
        DatePicked();
      });
    </script>
  </head>
  <body>
    <div>
      <label for="departure">Departure</label>
      <input type="text" id="departure" name="departure" />
    </div>
    <div>
      <label for="arrival">Arrival</label>
      <input type="text" id="arrival" name="arrival" />
    </div>
    <div>
      <label for="nights">Nights</label>
      <input type="text" id="nights" name="nights" />
    </div>
  </body>
</html>
